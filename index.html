<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë°©ê¸€ì´ë¥¼ ì§€ì¼œë¼</title>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            text-align: center;
            overflow-x: hidden; /* ì¢Œìš° ìŠ¤í¬ë¡¤ ë°©ì§€ */
            font-family: 'Nanum Gothic', sans-serif;
        }

        #gameCanvas {
            width: 93%;
            height: auto;
            max-width: 850px;
            display: block;
            margin: 0.5vh auto 2vh auto;
            padding : 5px;
            touch-action: manipulation;
            aspect-ratio: 17 / 30; /* 850/1500 ë¹„ìœ¨ */
        }

        canvas {
            touch-action: manipulation;
        }

        #startScreen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 5vw 6vw;
            border: 2px solid black;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            font-size: 1rem;
            width: 90%;
            max-width: 350px;
            border-radius: 12px;
            z-index: 2;
            box-sizing: border-box;
            display: flex; /* Flexbox ì¶”ê°€ */
            flex-direction: column; /* ì„¸ë¡œ ì •ë ¬ */
            align-items: center;
        }


        #startScreen input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            font-size: 16px;
            border-radius: 8px;
            border: 1px solid #ccc;
        }

        #startScreen button {
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            background-color: #00003E;
            color: white;
            border: none;
            border-radius: 8px;
        }
        
        #alertMessage {
             color: red; 
             font-size: 14px; 
             margin-bottom: 10px;
        }

        @media (max-width: 400px) {
            #startScreen {
                width: 90%;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    
    <!-- bang_game.jsë¥¼ ëª¨ë“ˆë³´ë‹¤ ë¨¼ì € ë¡œë“œí•˜ì—¬ startGame() ì •ì˜ê°€ í™•ì‹¤í•˜ê²Œ ì™„ë£Œë˜ë„ë¡ í•©ë‹ˆë‹¤. -->
    <script src="bang_game.js"></script>

    <div id="startScreen">
        <h2>ê²Œì„ ì‹œì‘ ì „ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</h2>
        <!-- alertMessage divê°€ startScreen ë‚´ë¶€ì— ìˆì–´ì•¼ ì ‘ê·¼ì´ ìš©ì´í•©ë‹ˆë‹¤. -->
        <div id="alertMessage"></div> 
        <input id="departmentInput" placeholder="ë¶€ì„œ (ì˜ˆ: ê°ì—¼ê´€ë¦¬ì‹¤)" /><br>
        <input id="nameInput" placeholder="ì´ë¦„ (ì˜ˆ: ìµœì•„ë¦„)" /><br>
        <!-- handleStart()ëŠ” window.handleStartë¡œ ì •ì˜ë˜ì—ˆìœ¼ë¯€ë¡œ window. ì—†ì´ í˜¸ì¶œí•©ë‹ˆë‹¤. -->
        <button onclick="handleStart()">ê²Œì„ ì‹œì‘</button>
    </div>

    <!-- ìº”ë²„ìŠ¤ëŠ” ì‹œì‘ í™”ë©´ê³¼ ê°™ì€ ë ˆë²¨ì— ìˆì–´ì•¼ í•©ë‹ˆë‹¤. -->
    <canvas id="gameCanvas" width="850" height="1500" style="display:none;"></canvas>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
// import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js";
import { getFirestore, collection, addDoc, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyB6Pn4hvYaER8GMduVmKKQEHtLimZoKqss",
    authDomain: "banggame-f2ae8.firebaseapp.com",
    projectId: "banggame-f2ae8",
    storageBucket: "banggame-f2ae8.firebasestorage.app",
    messagingSenderId: "494771436388",
    appId: "1:494771436388:web:30af5ee540176b8d501871",
    measurementId: "G-8H40NRTSEK"
};

const app = initializeApp(firebaseConfig);
// const analytics = getAnalytics(app);
const db = getFirestore(app);

// ì ìˆ˜ ì €ì¥ í•¨ìˆ˜
window.saveScoreToFirebase = async function(playerName, department, score) {
    try {
        await addDoc(collection(db, "rankings"), {
            name: playerName,
            department: department,
            score: score,
            timestamp: new Date()
        });

        console.log("ì ìˆ˜ ì €ì¥ ì„±ê³µ!");
    } catch (error) {
        console.error("âŒ ì €ì¥ ì‹¤íŒ¨:", error);
        // ì‚¬ìš©ìì—ê²ŒëŠ” ì½˜ì†”ì„ í†µí•´ ì˜¤ë¥˜ë¥¼ ì•Œë¦½ë‹ˆë‹¤. (ì•Œë¦¼ UI ì œê±°)
        console.log(`âš ï¸ ì ìˆ˜ ì €ì¥ ì‹¤íŒ¨. ì˜¤ë¥˜ ì½”ë“œ: ${error.message}`);
    }
};

// ë­í‚¹ ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜
window.loadTopRankings = async function(callback) {
    // ë­í‚¹ì€ score ë‚´ë¦¼ì°¨ìˆœë§Œ ì‚¬ìš©í•˜ê³ , timestampëŠ” ìƒ‰ì¸ ìƒì„±ì—ë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
    // âš ï¸ ê²½ê³ : ìƒ‰ì¸ì´ ì•„ì§ ì ìš© ì¤‘ì´ê±°ë‚˜ ì—†ëŠ” ê²½ìš°, ì´ ì¿¼ë¦¬ê°€ ì—¬ì „íˆ $100+$ Readsë¥¼ ìœ ë°œí•©ë‹ˆë‹¤.
    const q = query(collection(db, "rankings"), orderBy("score", "desc"), limit(5));
    const querySnapshot = await getDocs(q);
    const rankings = [];
    querySnapshot.forEach((doc) => {
        rankings.push(doc.data());
    });
    callback(rankings);
};

window.playerInfo = null;

// ê²Œì„ ì‹œì‘ í•¸ë“¤ëŸ¬ (windowì— ëª…ì‹œì ìœ¼ë¡œ í• ë‹¹)
window.handleStart = function() {
    const department = document.getElementById("departmentInput").value.trim();
    const name = document.getElementById("nameInput").value.trim();
    const alertMsg = document.getElementById("alertMessage");

    if (!department || !name) {
        // ğŸš¨ alert() ëŒ€ì‹  ì•ˆì „í•˜ê²Œ HTML ë©”ì‹œì§€ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
        alertMsg.innerText = "ë¶€ì„œì™€ ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.";
        return;
    }
    alertMsg.innerText = ""; // ë©”ì‹œì§€ ì´ˆê¸°í™”

    window.playerInfo = { department, playerName: name };

    document.getElementById("startScreen").style.display = "none";
    document.getElementById("gameCanvas").style.display = "block";

    // bang_game.jsì˜ startGame()ì„ ë°”ë¡œ í˜¸ì¶œí•©ë‹ˆë‹¤.
    if (typeof window.startGame === 'function') {
        window.startGame();
    } else {
        // ì´ ì˜¤ë¥˜ê°€ ëœ¨ë©´ bang_game.js íŒŒì¼ ë¡œë“œ ë˜ëŠ” startGame ì •ì˜ë¥¼ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.
        console.error("âŒ startGame í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê²Œì„ì„ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        document.getElementById("startScreen").style.display = "flex";
        document.getElementById("gameCanvas").style.display = "none";
    }
};

</script>
</body>
</html>































